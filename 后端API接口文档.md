# ç¯ä¿å±€é—®é¢˜äº¤åŠç³»ç»Ÿ - åç«¯APIæ¥å£æ–‡æ¡£

**ä½œè€…ï¼š** CorazoN  
**åˆ›å»ºæ—¶é—´ï¼š** 2025å¹´6æœˆ  
**ç‰ˆæœ¬ï¼š** v1.0  

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬ç³»ç»Ÿæ˜¯ç¯ä¿å±€é—®é¢˜äº¤åŠç³»ç»Ÿçš„å‰ç«¯é¡¹ç›®ï¼ŒåŒ…å«å››ä¸ªä¸»è¦ä¸šåŠ¡æ¨¡å—ï¼š
- ç£æŸ¥åœ¨çº¿ï¼ˆ3æ­¥æµç¨‹ï¼‰
- è¿œç¨‹å¸®æ‰¶ï¼ˆ3æ­¥æµç¨‹ï¼‰
- æ•°å­—åŒ–æŒ‡æŒ¥ä¸­å¿ƒï¼ˆ3æ­¥æµç¨‹ï¼‰
- çº¿ç´¢æ ¸æŸ¥ï¼ˆ3æ­¥æµç¨‹ï¼‰

## ğŸ”§ æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶ï¼š** Vue 3 + Composition API
- **UIç»„ä»¶åº“ï¼š** Element Plus
- **è·¯ç”±ï¼š** Vue Router 4
- **çŠ¶æ€ç®¡ç†ï¼š** Pinia (ç›®å‰ä½¿ç”¨ç®€å•çš„counter store)
- **HTTPå®¢æˆ·ç«¯ï¼š** åŸç”Ÿfetch API
- **æ„å»ºå·¥å…·ï¼š** Vite

## ğŸ“¡ APIæ¥å£éœ€æ±‚

### 1. åŸºç¡€æ¥å£

#### 1.1 ç”¨æˆ·è®¤è¯
```javascript
// ç™»å½•æ¥å£
POST /api/auth/login
{
  "username": "string",
  "password": "string"
}
// å“åº”
{
  "success": true,
  "data": {
    "token": "jwt_token",
    "user": {
      "id": "string",
      "name": "string",
      "role": "ç®¡ç†å‘˜|ä¸€ä¸­é˜Ÿäººå‘˜|è´Ÿè´£äºº|å±åœ°æ‰€äººå‘˜"
    }
  }
}

// ç™»å‡ºæ¥å£
POST /api/auth/logout
// å“åº”
{
  "success": true,
  "message": "ç™»å‡ºæˆåŠŸ"
}
```

#### 1.2 é—®é¢˜åˆ—è¡¨æ¥å£
```javascript
// è·å–é—®é¢˜åˆ—è¡¨
GET /api/issues?page=1&limit=10&formType=ç£æŸ¥åœ¨çº¿&status=è‰ç¨¿&search=å…³é”®è¯
// å“åº”
{
  "success": true,
  "data": {
    "list": [
      {
        "id": "string",
        "title": "string", // é—®é¢˜æ ‡é¢˜
        "formType": "ç£æŸ¥åœ¨çº¿|è¿œç¨‹å¸®æ‰¶|æ•°å­—åŒ–æŒ‡æŒ¥ä¸­å¿ƒ|çº¿ç´¢æ ¸æŸ¥",
        "status": "è‰ç¨¿|å·²æäº¤|å¤„ç†ä¸­|æ•´æ”¹ä¸­|å·²å®Œæˆ",
        "area": "é¾™å±±æ‰€|é€æ—æ‰€|åå¢©æ‰€|è§‚æµ·å«æ‰€|å‘¨å··æ‰€|æµ’å±±æ‰€",
        "responsible": "string", // è´Ÿè´£äºº
        "createdAt": "2025-06-01T10:00:00Z",
        "updatedAt": "2025-06-01T15:30:00Z"
      }
    ],
    "total": 100,
    "page": 1,
    "limit": 10
  }
}
```

### 2. è¡¨å•æ•°æ®æ¥å£

#### 2.1 ä¿å­˜è¡¨å•æ•°æ®
```javascript
// ä¿å­˜è¡¨å•æ•°æ®ï¼ˆæ”¯æŒè‰ç¨¿å’Œæäº¤ï¼‰
POST /api/issues/:id/form-data
{
  "step": 1, // å½“å‰æ­¥éª¤
  "status": "draft|submitted|processing|completed", // çŠ¶æ€
  "formData": {
    // æ ¹æ®ä¸åŒè¡¨å•ç±»å‹å’Œæ­¥éª¤ï¼Œæ•°æ®ç»“æ„ä¸åŒ
    "step1": { /* ç¬¬ä¸€æ­¥æ•°æ® */ },
    "step2": { /* ç¬¬äºŒæ­¥æ•°æ® */ },
    "step3": { /* ç¬¬ä¸‰æ­¥æ•°æ® */ }
  }
}
// å“åº”
{
  "success": true,
  "data": {
    "id": "string",
    "status": "string"
  }
}
```

#### 2.2 è·å–è¡¨å•æ•°æ®
```javascript
// è·å–å•ä¸ªé—®é¢˜è¯¦æƒ…
GET /api/issues/:id
// å“åº”
{
  "success": true,
  "data": {
    "id": "string",
    "formType": "string",
    "status": "string",
    "formData": {
      "step1": { /* ç¬¬ä¸€æ­¥æ•°æ® */ },
      "step2": { /* ç¬¬äºŒæ­¥æ•°æ® */ },
      "step3": { /* ç¬¬ä¸‰æ­¥æ•°æ® */ }
    },
    "processRecords": [ // å¤„ç†è®°å½•ï¼ˆç”¨äºç£æŸ¥åœ¨çº¿å’Œè¿œç¨‹å¸®æ‰¶ï¼‰
      {
        "id": "string",
        "status": "string",
        "createdAt": "2025-06-01T10:00:00Z",
        "data": { /* è®°å½•æ•°æ® */ }
      }
    ],
    "createdAt": "2025-06-01T10:00:00Z",
    "updatedAt": "2025-06-01T15:30:00Z"
  }
}
```

### 3. å„è¡¨å•ç±»å‹å…·ä½“å­—æ®µ

#### 3.1 ç£æŸ¥åœ¨çº¿
```javascript
// ç¬¬ä¸€æ­¥ï¼šé—®é¢˜ä¿¡æ¯
{
  "step1": {
    "title": "string", // é—®é¢˜æ ‡é¢˜
    "content": "string", // é—®é¢˜å†…å®¹
    "area": "é¾™å±±æ‰€|é€æ—æ‰€|åå¢©æ‰€|è§‚æµ·å«æ‰€|å‘¨å··æ‰€|æµ’å±±æ‰€", // å±åœ°
    "contact": "string" // è”ç³»äºº
  }
}

// ç¬¬äºŒæ­¥ï¼šæ•´æ”¹æªæ–½
{
  "step2": {
    "deadline": "2025-06-30T23:59:59Z", // æ•´æ”¹æ—¶é™
    "measures": "string", // æ•´æ”¹æªæ–½
    "status": "æ•´æ”¹ä¸­|æ•´æ”¹å®Œæˆ", // æ•´æ”¹çŠ¶æ€
    "completionTime": "2025-06-25T10:00:00Z", // æ•´æ”¹æ—¶é—´
    "situation": "string", // æ•´æ”¹æƒ…å†µ
    "nextPlan": "string", // ä¸‹æ­¥è®¡åˆ’
    "attachments": ["file1.pdf", "file2.jpg"] // é™„ä»¶åˆ—è¡¨
  }
}

// ç¬¬ä¸‰æ­¥ï¼šçŠ¶æ€æ˜¾ç¤ºï¼ˆæ— éœ€ä¿å­˜é¢å¤–æ•°æ®ï¼‰
{
  "step3": {
    "currentStatus": "æ•´æ”¹ä¸­|æ•´æ”¹å®Œæˆ"
  }
}
```

#### 3.2 è¿œç¨‹å¸®æ‰¶
```javascript
// ç¬¬ä¸€æ­¥ï¼šäº¤åŠä¿¡æ¯
{
  "step1": {
    "title": "string", // é—®é¢˜æ ‡é¢˜
    "content": "string", // é—®é¢˜å†…å®¹
    "area": "é¾™å±±æ‰€|é€æ—æ‰€|åå¢©æ‰€|è§‚æµ·å«æ‰€|å‘¨å··æ‰€|æµ’å±±æ‰€", // å±åœ°
    "contact": "string" // è”ç³»äºº
  }
}

// ç¬¬äºŒæ­¥ï¼šå¸®æ‰¶è¿‡ç¨‹
{
  "step2": {
    "problemContent": "string", // é—®é¢˜å†…å®¹
    "improvementSituation": "string", // æ•´æ”¹æƒ…å†µ
    "beforePhotos": ["photo1.jpg"], // æ•´æ”¹å‰ç…§ç‰‡
    "afterPhotos": ["photo2.jpg"] // æ•´æ”¹åç…§ç‰‡
  }
}

// ç¬¬ä¸‰æ­¥ï¼šæ•´æ”¹æƒ…å†µï¼ˆå›ºå®šæ˜¾ç¤ºæ•´æ”¹å®Œæˆï¼‰
{
  "step3": {
    "status": "æ•´æ”¹å®Œæˆ"
  }
}
```

#### 3.3 æ•°å­—åŒ–æŒ‡æŒ¥ä¸­å¿ƒ
```javascript
// ç¬¬ä¸€æ­¥ï¼šäº¤åŠä¿¡æ¯ï¼ˆä¸€ä¸­é˜Ÿäººå‘˜å¡«å†™ï¼‰
{
  "step1": {
    "assignmentField": "string", // äº¤åŠå­—æ®µ
    "area": "é¾™å±±æ‰€|é€æ—æ‰€|å‘¨å··æ‰€|åå¢©æ‰€|è§‚æµ·å«æ‰€|æµ’å±±æ‰€", // å±åœ°
    "responsible": "string", // è´Ÿè´£äºº
    "problemType": "string", // é—®é¢˜ç±»å‹ï¼ˆè¾“å…¥æ¡†ï¼‰
    "clueDescription": "string" // çº¿ç´¢æè¿°
  }
}

// ç¬¬äºŒæ­¥ï¼šé—®é¢˜äº¤åŠï¼ˆå±åœ°æ‰€äººå‘˜å¡«å†™ï¼‰
{
  "step2": {
    "investigationFeedback": "string", // æ ¸æŸ¥åé¦ˆ
    "investigationSituation": "string", // è°ƒæŸ¥æ ¸å®æƒ…å†µ
    "handlingSituation": "string" // å¤„ç†æƒ…å†µ
  }
}

// ç¬¬ä¸‰æ­¥ï¼šæ•´æ”¹æƒ…å†µï¼ˆå±åœ°æ‰€äººå‘˜æŸ¥çœ‹ï¼Œå›ºå®šæ˜¾ç¤ºæ•´æ”¹å®Œæˆï¼‰
{
  "step3": {
    "status": "æ•´æ”¹å®Œæˆ"
  }
}
```

#### 3.4 çº¿ç´¢æ ¸æŸ¥
```javascript
// ç¬¬ä¸€æ­¥ï¼šäº¤åŠä¿¡æ¯ï¼ˆä¸€ä¸­é˜Ÿäººå‘˜å¡«å†™ï¼‰
{
  "step1": {
    "assignDate": "2025-06-01", // äº¤åŠæ—¥æœŸ
    "area": "æµ’å±±è¡—é“|å¤å¡˜è¡—é“|ç™½æ²™è·¯è¡—é“|å®—æ±‰è¡—é“|åå¢©è¡—é“|é¾™å±±é•‡|æŒèµ·é•‡|è§‚æµ·å«é•‡|é™„æµ·é•‡|æ¡¥å¤´é•‡|åŒ¡å °é•‡|é€æ—é•‡|æ–°æµ¦é•‡|èƒœå±±é•‡|æ¨ªæ²³é•‡|å´‡å¯¿é•‡|åºµä¸œé•‡|é•¿æ²³é•‡|å‘¨å··é•‡", // å±åœ°ï¼ˆæ…ˆæºªä¹¡é•‡è¡—é“ï¼‰
    "jurisdictionOffice": "é¾™å±±æ‰€|é€æ—æ‰€|å‘¨å··æ‰€|åå¢©æ‰€|è§‚æµ·å«æ‰€|æµ’å±±æ‰€", // è¾–åŒºæ‰€
    "responsible": "string", // è´Ÿè´£äºº
    "problemType": "ç”¨ç”µç›‘æ§|ç¯å¢ƒä¿¡è®¿|åœ¨çº¿ç›‘æ§", // é—®é¢˜ç±»å‹
    "clueDescription": "string" // çº¿ç´¢æè¿°
  }
}

// ç¬¬äºŒæ­¥ï¼šé—®é¢˜äº¤åŠï¼ˆå±åœ°æ‰€äººå‘˜å¡«å†™ï¼‰
{
  "step2": {
    "investigationResult": "string", // è°ƒæŸ¥æ ¸å®æƒ…å†µ
    "handlingSituation": "string", // å¤„ç†æƒ…å†µ
    "supervisionSituation": "string", // ç£ä¿ƒæ•´æ”¹æƒ…å†µ
    "images": ["image1.jpg", "image2.jpg"], // å›¾ç‰‡ä¸Šä¼ 
    "files": ["file1.pdf", "file2.docx"] // æ–‡ä»¶ä¸Šä¼ 
  }
}

// ç¬¬ä¸‰æ­¥ï¼šæ•´æ”¹æƒ…å†µï¼ˆå›ºå®šæ˜¾ç¤ºæ•´æ”¹å®Œæˆï¼‰
{
  "step3": {
    "status": "æ•´æ”¹å®Œæˆ"
  }
}
```

### 4. æ–‡ä»¶ä¸Šä¼ æ¥å£

```javascript
// æ–‡ä»¶ä¸Šä¼ 
POST /api/upload
Content-Type: multipart/form-data
{
  "file": File, // æ–‡ä»¶å¯¹è±¡
  "type": "image|document" // æ–‡ä»¶ç±»å‹
}
// å“åº”
{
  "success": true,
  "data": {
    "url": "string", // æ–‡ä»¶è®¿é—®URL
    "filename": "string", // æ–‡ä»¶å
    "size": 1024 // æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
  }
}
```

### 5. æŠ¥å‘Šç”Ÿæˆæ¥å£

```javascript
// ç”ŸæˆPDFæŠ¥å‘Š
POST /api/reports/generate
{
  "issueId": "string",
  "formType": "ç£æŸ¥åœ¨çº¿|è¿œç¨‹å¸®æ‰¶|æ•°å­—åŒ–æŒ‡æŒ¥ä¸­å¿ƒ|çº¿ç´¢æ ¸æŸ¥"
}
// å“åº”
{
  "success": true,
  "data": {
    "reportUrl": "string", // æŠ¥å‘Šä¸‹è½½é“¾æ¥
    "filename": "string"
  }
}
```

## ğŸ” æƒé™æ§åˆ¶

### ç”¨æˆ·è§’è‰²æƒé™
- **ç®¡ç†å‘˜ï¼š** æ‰€æœ‰æƒé™ï¼ˆåˆ›å»ºã€ç¼–è¾‘ã€æŸ¥çœ‹ã€åˆ é™¤ï¼‰
- **ä¸€ä¸­é˜Ÿäººå‘˜ï¼š** åˆ›å»ºé—®é¢˜ã€æäº¤é—®é¢˜ã€æŸ¥çœ‹æ‰€æœ‰é—®é¢˜åˆ—è¡¨ã€å¡«å†™ç¬¬ä¸€æ­¥äº¤åŠä¿¡æ¯
- **å±åœ°æ‰€äººå‘˜ï¼š** æŸ¥çœ‹åˆ†é…ç»™è‡ªå·±å±åœ°çš„é—®é¢˜ã€å¡«å†™ç¬¬äºŒæ­¥é—®é¢˜äº¤åŠã€å¤„ç†æ•´æ”¹æƒ…å†µ

### ä¸šåŠ¡æµç¨‹è¯´æ˜
1. **ä¸€ä¸­é˜Ÿäººå‘˜** åˆ›å»ºé—®é¢˜å¹¶å¡«å†™ç¬¬ä¸€æ­¥"äº¤åŠä¿¡æ¯"
2. **å±åœ°æ‰€äººå‘˜** æ¥æ”¶ä»»åŠ¡ï¼Œå¡«å†™ç¬¬äºŒæ­¥"é—®é¢˜äº¤åŠ"
3. **å±åœ°æ‰€äººå‘˜** å®Œæˆå¤„ç†åï¼Œæ›´æ–°ç¬¬ä¸‰æ­¥"æ•´æ”¹æƒ…å†µ"

### JWT Token
æ‰€æœ‰APIè¯·æ±‚éœ€è¦åœ¨Headerä¸­æºå¸¦JWT Tokenï¼š
```
Authorization: Bearer <jwt_token>
```

## ğŸ“Š çŠ¶æ€æµè½¬

### ç£æŸ¥åœ¨çº¿çŠ¶æ€æµè½¬
```
è‰ç¨¿ â†’ å·²æäº¤ â†’ æ•´æ”¹ä¸­ â†’ æ•´æ”¹å®Œæˆ
```

### å…¶ä»–è¡¨å•çŠ¶æ€æµè½¬
```
è‰ç¨¿ â†’ å·²æäº¤ â†’ å¤„ç†ä¸­ â†’ å·²å®Œæˆ
```

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡å»ºè®®

### ä¸»è¦æ•°æ®è¡¨

#### issues è¡¨ï¼ˆé—®é¢˜ä¸»è¡¨ï¼‰
```sql
CREATE TABLE issues (
  id VARCHAR(36) PRIMARY KEY,
  form_type ENUM('ç£æŸ¥åœ¨çº¿', 'è¿œç¨‹å¸®æ‰¶', 'æ•°å­—åŒ–æŒ‡æŒ¥ä¸­å¿ƒ', 'çº¿ç´¢æ ¸æŸ¥'),
  status ENUM('è‰ç¨¿', 'å·²æäº¤', 'å¤„ç†ä¸­', 'æ•´æ”¹ä¸­', 'å·²å®Œæˆ'),
  title VARCHAR(200),
  area ENUM('é¾™å±±æ‰€', 'é€æ—æ‰€', 'åå¢©æ‰€', 'è§‚æµ·å«æ‰€', 'å‘¨å··æ‰€', 'æµ’å±±æ‰€'),
  responsible VARCHAR(100),
  created_by VARCHAR(36),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
```

#### issue_form_data è¡¨ï¼ˆè¡¨å•æ•°æ®ï¼‰
```sql
CREATE TABLE issue_form_data (
  id VARCHAR(36) PRIMARY KEY,
  issue_id VARCHAR(36),
  step_number INT,
  form_data JSON,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (issue_id) REFERENCES issues(id)
);
```

#### process_records è¡¨ï¼ˆå¤„ç†è®°å½•ï¼‰
```sql
CREATE TABLE process_records (
  id VARCHAR(36) PRIMARY KEY,
  issue_id VARCHAR(36),
  status VARCHAR(50),
  record_data JSON,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (issue_id) REFERENCES issues(id)
);
```

## ğŸš€ éƒ¨ç½²è¯´æ˜

### å‰ç«¯é…ç½®æ–‡ä»¶éœ€è¦ä¿®æ”¹çš„åœ°æ–¹

1. **src/utils/api.js** - ä¿®æ”¹APIåŸºç¡€URL
```javascript
// å¼€å‘ç¯å¢ƒ
const DEV_BASE_URL = 'http://localhost:3000/api'
// ç”Ÿäº§ç¯å¢ƒ  
const PROD_BASE_URL = 'https://your-domain.com/api'
```

2. **ç¯å¢ƒå˜é‡é…ç½®**
åˆ›å»º `.env.production` æ–‡ä»¶ï¼š
```
VITE_API_BASE_URL=https://your-domain.com/api
VITE_APP_TITLE=ç¯ä¿å±€é—®é¢˜äº¤åŠç³»ç»Ÿ
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **CORSé…ç½®ï¼š** åç«¯éœ€è¦é…ç½®CORSå…è®¸å‰ç«¯åŸŸåè®¿é—®
2. **æ–‡ä»¶å­˜å‚¨ï¼š** å»ºè®®ä½¿ç”¨äº‘å­˜å‚¨æœåŠ¡ï¼ˆå¦‚é˜¿é‡Œäº‘OSSï¼‰å­˜å‚¨ä¸Šä¼ çš„æ–‡ä»¶
3. **æ•°æ®å¤‡ä»½ï¼š** å®šæœŸå¤‡ä»½æ•°æ®åº“ï¼Œç‰¹åˆ«æ˜¯é—®é¢˜æ•°æ®å’Œå¤„ç†è®°å½•
4. **æ—¥å¿—è®°å½•ï¼š** è®°å½•ç”¨æˆ·æ“ä½œæ—¥å¿—ï¼Œä¾¿äºé—®é¢˜è¿½è¸ª
5. **å®‰å…¨æ€§ï¼š** å¯¹æ•æ„Ÿæ“ä½œè¿›è¡Œæƒé™éªŒè¯ï¼Œé˜²æ­¢è¶Šæƒè®¿é—®

## ğŸ”„ ç°æœ‰Mock APIæ˜ å°„

å½“å‰å‰ç«¯ä½¿ç”¨MockAPIï¼Œå®é™…æ¥å£å¯¹åº”å…³ç³»ï¼š
- `MockAPI.saveFormData()` â†’ `POST /api/issues/:id/form-data`
- `MockAPI.getIssue()` â†’ `GET /api/issues/:id`
- `MockAPI.getIssueList()` â†’ `GET /api/issues`

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰æŠ€æœ¯é—®é¢˜ï¼Œè¯·è”ç³»å‰ç«¯å¼€å‘è€…ï¼šCorazoN 